<!DOCTYPE html>
<html>
<head>
	<title>WebSocket Test</title>
	<script type='text/javascript' src='js/listeners/init.js' /></script>
	<style>
		pre#timer {
			border: 1px solid black;
		}
	</style>
</head>
<body>
	<div style="border: solid 1px #aaa;">
		<p>Initialization:</p>
		<input type='text' id='input_name' />
		<button type="button" onclick="entry()">Entry</button>
		<button type="button" onclick="retire()">Retire</button>
	</div>
	<div style="border: solid 1px #aaa;">
		<button type="button" onclick="show()">Show</button>
	</div>
	<div style="border: solid 1px #aaa;">
		<input type='text' id='x1' />
		<input type='text' id='y1' />
		<hr>
		<input type='text' id='x2' />
		<input type='text' id='y2' />
		<button type="button" onclick="step()">Step</button>
	</div>
	<div style="border: solid 1px #aaa;">
		<label for='putFrom'><input type='text' id='putFrom' />
		<hr>
		<input type='text' id='putX' />
		<input type='text' id='putY' />
		<button type="button" onclick="put()">Put</button>
	</div>
</body>
<script type='text/javascript'>
var obj = initWs(getBaseURL());
var thisSide = null;

function entry() {
	obj.socket.send(JSON.stringify({
			class: 'entry',
			type: '1hour/1min',
			name: document.getElementById('input_name').value
		}));
}
function retire() {
	obj.socket.send(JSON.stringify({
			class: 'retire'
		}));
}
function show() {
	obj.socket.send(JSON.stringify({
		class: 'show'
	}));
}
function step() {
	function idVal(id) {
		return document.getElementById(id).value;
	}
	var x1 = Number(idVal('x1'));
	var y1 = Number(idVal('y1'));
	var x2 = Number(idVal('x2'));
	var y2 = Number(idVal('y2'));
	obj.socket.send(JSON.stringify({
		class: 'step',
		side: thisSide,
		from: {
			x: x1,
			y: y1
		},
		to: {
			x: x2,
			y: y2
		}
	}));
}

function put() {
	function idVal(id) {
		return document.getElementById(id).value;
	}
	var index = Number(idVal('putFrom'));
	var x = Number(idVal('putX'));
	var y = Number(idVal('putY'));
	console.log(index, x, y);
	obj.socket.send(JSON.stringify({
		class: 'put',
		side: thisSide,
		indexInHand: index,
		to: {
			x: x,
			y: y
		}
	}));
}

function getBaseURL() {
	var href = window.location.href.substring(7); // strip "http://"
	var idx = href.indexOf("/");
	return "ws://" + href.substring(0, idx);
}
</script>
</html>
